<div class="container-fluid Header">
  <div class="ar-style">
    <div class="mat-display-1 mb-3 mt-5" color="primary">
      <button class="form-close" mat-icon-button (click)="rightDrawer.close()">
        <mat-icon style="color: black">close</mat-icon>
      </button>
      {{ notificationId ? ('notification.form.edit' | translate) : ('notification.form.compose' | translate)}}
    </div>
    <mat-divider class="mb-3"></mat-divider>
  </div>
  <div class="container">
    <mat-card class="mat-elevation-z4 col">
      <form [formGroup]="form">
        <div class="row">
          <div class="col-lg-6">
            <div class="Header">
              <h3>{{'notification.form.details' | translate}}</h3>
            </div>
            <mat-form-field appearance="outline">
              <mat-label>{{ "notification.form.englishTitle" | translate }}</mat-label>
              <input matInput formControlName="englishTitle" #englishTitle maxlength="100" autocomplete="off" />
              <mat-hint>100/{{englishTitle.value?.length || 0}}</mat-hint>
              <mat-error>{{ ("notification.form.englishTitle" | translate) + ("notification.form.requiredHint" |
                translate) }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>{{ "notification.form.arabicTitle" | translate }}</mat-label>
              <input matInput formControlName="arabicTitle" #arabicTitle maxlength="100" autocomplete="off" />
              <mat-hint>100/{{arabicTitle.value?.length || 0}}</mat-hint>
              <mat-error>{{ ("notification.form.arabicTitle" | translate) + ("notification.form.requiredHint" |
                translate) }}
              </mat-error>
            </mat-form-field>

            <div class="mat-form-field">
              <editor formControlName="englishMessage" apiKey="453j3kfpj3lqmji9dnw0u7owlljuhidx0c785b4diqps81fd" [init]="{placeholder: ('notification.form.englishDetails' | translate),
              directionality :languageService.lang == 'en' ? 'ltr' : 'rtl',
              icons: 'material',
              min_height: 400,
              plugins: 'print preview importcss tinydrive searchreplace autolink autosave save directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern noneditable help charmap quickbars emoticons',
              tinydrive_token_provider: 'URL_TO_YOUR_TOKEN_PROVIDER',
              tinydrive_dropbox_app_key: 'YOUR_DROPBOX_APP_KEY',
              tinydrive_google_drive_key: 'YOUR_GOOGLE_DRIVE_KEY',
              tinydrive_google_drive_client_id: 'YOUR_GOOGLE_DRIVE_CLIENT_ID',
              menu: {
              tc: {
              title: 'Comments',
              items: 'addcomment showcomments deleteallconversations'
              }
              },
              menubar: 'file edit view insert format tools table tc help',
              toolbar: 'undo redo | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist checklist | fontselect fontsizeselect formatselect | forecolor backcolor casechange permanentpen formatpainter removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media pageembed template link anchor codesample | a11ycheck ltr rtl | showcomments addcomment',
              autosave_ask_before_unload: true,
              autosave_interval: '30s',
              autosave_prefix: '{path}{query}-{id}-',
              autosave_restore_when_empty: false,
              autosave_retention: '2m',
              image_advtab: true,
              link_list: [
              { title: 'My page 1', value: 'https://www.tiny.cloud' },
              { title: 'My page 2', value: 'http://www.moxiecode.com' }
              ],
              importcss_append: true,
              image_caption: true,
              quickbars_selection_toolbar: 'bold italic | quicklink h2 h3 blockquote quickimage quicktable',
              noneditable_noneditable_class: 'mceNonEditable',
              toolbar_mode: 'sliding',
              spellchecker_ignore_list: ['Ephox', 'Moxiecode'],
              tinycomments_mode: 'embedded',
              content_style: '.mymention{ color: gray; }',
              contextmenu: 'link image imagetools table configurepermanentpen',
              a11y_advanced_options: true,
              skin: 'oxide',
              content_css: 'default'}">
              </editor>
              <mat-error *ngIf="form.get('englishDetails')?.touched && form.get('englishDetails')?.invalid">
                {{ ("notification.form.englishDetails" | translate) + ("notification.form.requiredHint" | translate) }}
              </mat-error>
            </div>

            <div class="mat-form-field">
              <editor formControlName="arabicMessage" apiKey="453j3kfpj3lqmji9dnw0u7owlljuhidx0c785b4diqps81fd" [init]="{placeholder: ('notification.form.arabicDetails' | translate),
              directionality :languageService.lang == 'en' ? 'ltr' : 'rtl',
              icons: 'material',
              min_height: 400,
              plugins: 'print preview importcss tinydrive searchreplace autolink autosave save directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern noneditable help charmap quickbars emoticons',
              tinydrive_token_provider: 'URL_TO_YOUR_TOKEN_PROVIDER',
              tinydrive_dropbox_app_key: 'YOUR_DROPBOX_APP_KEY',
              tinydrive_google_drive_key: 'YOUR_GOOGLE_DRIVE_KEY',
              tinydrive_google_drive_client_id: 'YOUR_GOOGLE_DRIVE_CLIENT_ID',
              menu: {
              tc: {
              title: 'Comments',
              items: 'addcomment showcomments deleteallconversations'
              }
              },
              menubar: 'file edit view insert format tools table tc help',
              toolbar: 'undo redo | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist checklist | fontselect fontsizeselect formatselect | forecolor backcolor casechange permanentpen formatpainter removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media pageembed template link anchor codesample | a11ycheck ltr rtl | showcomments addcomment',
              autosave_ask_before_unload: true,
              autosave_interval: '30s',
              autosave_prefix: '{path}{query}-{id}-',
              autosave_restore_when_empty: false,
              autosave_retention: '2m',
              image_advtab: true,
              link_list: [
              { title: 'My page 1', value: 'https://www.tiny.cloud' },
              { title: 'My page 2', value: 'http://www.moxiecode.com' }
              ],
              importcss_append: true,
              image_caption: true,
              quickbars_selection_toolbar: 'bold italic | quicklink h2 h3 blockquote quickimage quicktable',
              noneditable_noneditable_class: 'mceNonEditable',
              toolbar_mode: 'sliding',
              spellchecker_ignore_list: ['Ephox', 'Moxiecode'],
              tinycomments_mode: 'embedded',
              content_style: '.mymention{ color: gray; }',
              contextmenu: 'link image imagetools table configurepermanentpen',
              a11y_advanced_options: true,
              skin: 'oxide',
              content_css: 'default'}">
              </editor>
              <mat-error *ngIf="form.get('arabicDetails')?.touched && form.get('arabicDetails')?.invalid">
                {{ ("notification.form.arabicDetails" | translate) + ("notification.form.requiredHint" | translate) }}
              </mat-error>
            </div>

            <app-upload-file [error]="!form.get('images')?.value ? 'notification.form.hint' : null"
              formControlName="images" label="notification.form.image" hint="image.ImageHint" [isRequired]="true"
              [isMultiple]="true"></app-upload-file>
          </div>

          <div class="col-lg-6">
            <div class="Header">
              <h3>{{'notification.form.preview' | translate}}</h3>
            </div>
            <cdk-virtual-scroll-viewport itemSize="50">
              <mat-carousel timings="250ms ease-in" [autoplay]="false" [interval]="5000" color="accent" maxWidth="auto"
                [proportion]="50" [loop]="true" [hideArrows]="!form.get('images')?.value ? true : false"
                [hideIndicators]="!form.get('images')?.value ? true : false" [useKeyboard]="true"
                [useMouseWheel]="false">
                <mat-carousel-slide *ngIf="!form.get('images')?.value" image="assets/images/no-notification.png"
                  overlayColor="#00000040" [hideOverlay]="true"></mat-carousel-slide>
                <mat-carousel-slide *ngFor="let slide of form.get('images')?.value; let i = index"
                  [image]="slide.fileBase64 ? 'data:image/jpeg;base64,'+slide.fileBase64 : slide.path"
                  overlayColor="#00000040" [hideOverlay]="true">
                </mat-carousel-slide>
              </mat-carousel>
              <div class="p-3" [ngClass]="languageService.lang == 'en' ? 'text-left' : 'text-right'">
                <h3>
                  {{languageService.lang == 'en' ? form.get('englishTitle')?.value : form.get('arabicTitle')?.value }}
                </h3>
                <hr>
                <div
                  [innerHTML]="languageService.lang == 'en' ? form.get('englishMessage')?.value : form.get('arabicMessage')?.value">
                </div>
              </div>
            </cdk-virtual-scroll-viewport>

            <mat-form-field appearance="outline">
              <mat-label>{{ "notification.form.groups" | translate }}</mat-label>
              <mat-chip-list #chipListGroup>
                <mat-chip *ngFor="let group of selectedGroups" [selectable]="true" [removable]="true"
                  (removed)="removeGroup(group)">
                  {{group}}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
                <input #groupInput formControlName="toGroups" [matAutocomplete]="autoGroup"
                  [matChipInputFor]="chipListGroup" [matChipInputSeparatorKeyCodes]="separatorKeysCodes">
              </mat-chip-list>
              <mat-autocomplete #autoGroup="matAutocomplete"
                (optionSelected)="selectGroup($event.option.viewValue,true)">
                <mat-option *ngFor="let group of filteredGroups | async" [value]="group">
                  {{group}}
                </mat-option>
              </mat-autocomplete>
              <mat-hint>{{ "notification.form.hintGroups" | translate }}</mat-hint>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ "notification.form.units" | translate }}</mat-label>
              <mat-chip-list #chipListUnit>
                <mat-chip *ngFor="let unit of selectedUnits" [selectable]="true" [removable]="true"
                  (removed)="removeUnit(unit)">
                  {{unit}}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
                <input #unitInput formControlName="toUnits" [matAutocomplete]="autoUnit"
                  [matChipInputFor]="chipListUnit" [matChipInputSeparatorKeyCodes]="separatorKeysCodes">
              </mat-chip-list>
              <mat-autocomplete #autoUnit="matAutocomplete" (optionSelected)="selectUnit($event.option.viewValue)">
                <mat-option *ngFor="let unit of filteredUnits | async" [value]="unit">
                  {{unit}}
                </mat-option>
              </mat-autocomplete>
              <mat-hint>{{ "notification.form.hintUnits" | translate }}</mat-hint>
            </mat-form-field>

            <mat-checkbox formControlName="isOwnerOnly">{{'notification.form.isOwnerOnly' | translate}}</mat-checkbox>
          </div>

          <div class="col-lg-12 screen-actions">
            <button *ngIf="currentUserService.checkRolePageAction(SystemPageActions.NotificationsEdit)"   [class.spinner]="loading" [disabled]="loading || form.invalid" mat-raised-button color="accent"
              (click)="onSubmit()">
              <span color="white">
                {{ notificationId ? ("notification.form.editBtn" | translate) : ("notification.form.addBtn" | translate)
                }}</span>
            </button>
            <button mat-raised-button (click)="rightDrawer.close()">
              {{ "notification.form.cancel" | translate }}
            </button>
          </div>
        </div>
      </form>
    </mat-card>
  </div>
</div>
